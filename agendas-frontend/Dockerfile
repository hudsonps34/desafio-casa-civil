# ğŸ› ï¸ Etapa 1: ConstruÃ§Ã£o da aplicaÃ§Ã£o (Imagem maior, mas apenas para build)
FROM node:18-alpine AS builder

# Definir diretÃ³rio de trabalho dentro do container
WORKDIR /app

# Copiar arquivos essenciais para instalar dependÃªncias
COPY package.json package-lock.json ./

# Instalar dependÃªncias sem armazenar cache desnecessÃ¡rio
RUN npm install --omit=dev

# Copiar o restante do cÃ³digo-fonte para o container
COPY . .

# Construir o frontend (gera a pasta `build`)
RUN npm run build


# ğŸ—ï¸ Etapa 2: Container final otimizado (Imagem menor e mais leve)
FROM node:18-alpine

# Definir diretÃ³rio de trabalho dentro do container
WORKDIR /app

# Copiar apenas os arquivos da build final (evita arquivos desnecessÃ¡rios)
COPY --from=builder /app/build ./build

# Expor a porta onde o frontend serÃ¡ servido
EXPOSE 80

# Servir a aplicaÃ§Ã£o estÃ¡tica usando `serve`
CMD ["npx", "serve", "-s", "build", "-l", "80"]
